<div class="new_board_popup">
    <form action="/newboard" method="POST">
        <img id="select_board_image">
        <button id="select_image_button" type="button">이미지 선택</button>

        <input type="text" placeholder="제목 입력">
        <textarea placeholder="내용 입력"></textarea>
        <input type="submit" value="업로드">
    </form>
    
    <button type="button" class="new_board_close_btn"></button>

    <div class="savebox_image_background">
        <div class="savebox_image_block">
        </div>
    </div>
</div>

<script>
    let new_board_popup_block = document.querySelector(".new_board_popup_block");
    let new_post_button = document.getElementById("new_post_button");
    let new_board_close_btn = document.querySelector(".new_board_close_btn");

    new_post_button.addEventListener('click', function(){
        new_board_popup_block.classList.add('on');
    })

    new_board_close_btn.addEventListener('click', function() {
        new_board_popup_block.classList.remove('on');
    })

    let savebox_image_background = document.querySelector(".savebox_image_background");
    let savebox_image_block = document.querySelector(".savebox_image_block");
    let select_image_button = document.getElementById("select_image_button");

    select_image_button.addEventListener('click', function() {
        savebox_image_background.classList.add('on');
        select_savebox();
    })

    async function select_savebox() {
        savebox_image_block.innerHTML = "";
        
        let savebox_select_close_btn = document.createElement("button");
        savebox_select_close_btn.setAttribute("type", "button");
        savebox_select_close_btn.setAttribute("class", "savebox_select_close_btn");
        savebox_image_block.appendChild(savebox_select_close_btn);
        savebox_select_close_btn.addEventListener('click', function() {
            savebox_image_background.classList.remove('on');
        })

        const response_data = await fetch("/selectsavebox", {
            method: "POST",
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({})
        })
        .then(res => res.json())

        let savebox_data = response_data.savebox_data;

        if (savebox_data.length <= 0) {
            let empty_text = document.createElement("div");
            empty_text.setAttribute("class", "empty_text")
            empty_text.innerHTML = "아직 사진이 없습니다.";
            savebox_image_block.appendChild(empty_text);
            return
        }

        let select_board_image = document.getElementById("select_board_image");

        for (let i = 0; i < savebox_data.length; i++) {
            let savebox_block = document.createElement("div");
            savebox_block.setAttribute("class", "savebox_block");
            savebox_block.setAttribute("id", savebox_data[i][0]);
            
            let savebox_image = document.createElement("img");
            savebox_image.setAttribute("class", "savebox_image");
            savebox_image.setAttribute("src", savebox_data[i][1]);
            savebox_block.appendChild(savebox_image);
        
            savebox_image_block.appendChild(savebox_block);

            savebox_block.addEventListener('click', function() {
                select_board_image.src = savebox_image.src;
                savebox_block.style.border = "solid";
            })
        }
    }
</script>
